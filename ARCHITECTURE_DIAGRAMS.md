# ğŸ¯ Favorite Hotel - Architecture & Flow Diagrams

## ğŸ“ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CLIENT (React)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚  SearchItem      â”‚  â”‚  Hotel Detail    â”‚                â”‚
â”‚  â”‚  Component       â”‚  â”‚  Page            â”‚                â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚                â”‚
â”‚  â”‚  [Heart Icon]    â”‚  â”‚  [Heart Icon]    â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚           â”‚                      â”‚                          â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                      â”‚                                      â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚              â”‚ FavoriteButton â”‚                            â”‚
â”‚              â”‚  Component     â”‚                            â”‚
â”‚              â”‚ (Reusable)     â”‚                            â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                      â”‚                                      â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚              â”‚  Favorites     â”‚                            â”‚
â”‚              â”‚  Page          â”‚                            â”‚
â”‚              â”‚ (/favorites)   â”‚                            â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ HTTP Requests
            â”‚ (axios/fetch)
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               BACKEND API (Express.js)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Route: /api/favorites                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ POST   /:userId/toggle                        â”‚          â”‚
â”‚  â”‚ POST   /:userId/add                           â”‚          â”‚
â”‚  â”‚ POST   /:userId/remove                        â”‚          â”‚
â”‚  â”‚ GET    /:userId/check                         â”‚          â”‚
â”‚  â”‚ GET    /:userId                               â”‚          â”‚
â”‚  â”‚ GET    /:userId/hotels                        â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                â”‚                                            â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚        â”‚ Favorite       â”‚                                   â”‚
â”‚        â”‚ Controller     â”‚                                   â”‚
â”‚        â”‚ (favorite.js)  â”‚                                   â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                 â”‚                                           â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚      â”‚                     â”‚                               â”‚
â”‚      â–¼                     â–¼                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚ Users  â”‚            â”‚ Hotels â”‚                          â”‚
â”‚  â”‚ Model  â”‚            â”‚ Model  â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚      â”‚                     â”‚                               â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                 â”‚                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â”‚ Database Operations
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              DATABASE (MongoDB)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  User Collection:                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚ {                            â”‚                          â”‚
â”‚  â”‚   _id: ObjectId,             â”‚                          â”‚
â”‚  â”‚   username: "user123",       â”‚                          â”‚
â”‚  â”‚   email: "user@example.com", â”‚                          â”‚
â”‚  â”‚   favorites: [               â”‚â—„â”€â”€â”€â”€ Favorite Hotel IDs  â”‚
â”‚  â”‚     "hotel1_id",             â”‚                          â”‚
â”‚  â”‚     "hotel2_id",             â”‚                          â”‚
â”‚  â”‚     "hotel3_id"              â”‚                          â”‚
â”‚  â”‚   ]                          â”‚                          â”‚
â”‚  â”‚ }                            â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                              â”‚
â”‚  Hotel Collection:                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚ {                            â”‚                          â”‚
â”‚  â”‚   _id: ObjectId,             â”‚                          â”‚
â”‚  â”‚   name: "Grand Hotel",       â”‚                          â”‚
â”‚  â”‚   city: "HÃ  Ná»™i",            â”‚                          â”‚
â”‚  â”‚   cheapestPrice: 500000,     â”‚                          â”‚
â”‚  â”‚   ...                        â”‚                          â”‚
â”‚  â”‚ }                            â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ User Flow Diagram

### Adding a Favorite Hotel

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User      â”‚
â”‚   Not       â”‚
â”‚   Logged In â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
   Click Heart Icon
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Check Authentication    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    No  â”‚  Yes
    â”€â”€â”€â”€â”¼â”€â”€â”€â”€
    â”‚   â”‚   
    â”‚   â–¼
    â”‚ POST /favorites/:userId/toggle
    â”‚   â”œâ”€ hotelId
    â”‚   â””â”€ User verified via JWT
    â”‚   â”‚
    â”‚   â–¼
    â”‚ Backend finds User
    â”‚   â”‚
    â”‚   â–¼
    â”‚ Check if already favorite
    â”‚   â”‚
    â”‚   â”œâ”€ Yes: Remove from array
    â”‚   â””â”€ No: Add to array
    â”‚   â”‚
    â”‚   â–¼
    â”‚ Update MongoDB
    â”‚   â”‚
    â”‚   â–¼
    â”‚ Return { isFavorite: true }
    â”‚   â”‚
    â”‚   â–¼
    â”‚ Update UI
    â”‚ â¤ï¸ Heart turns Red
    â”‚ Tooltip: "ÄÃ£ thÃ­ch"
    â”‚ Animation plays
    â”‚
    â–¼
Show Login Dialog
"Vui lÃ²ng Ä‘Äƒng nháº­p"
```

---

## ğŸ¬ Component Lifecycle

### FavoriteButton Component

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     FavoriteButton Component           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
    Component Mount
           â”‚
           â–¼
    useEffect Hook
    â”œâ”€ Check: user?._id && hotelId
    â”‚
    â”œâ”€ Yes: Call checkFavorite()
    â”‚   â”‚
    â”‚   â–¼
    â”‚   GET /check?hotelId=...
    â”‚   â”‚
    â”‚   â–¼
    â”‚   Set isFavorite state
    â”‚
    â”œâ”€ No: Wait for conditions
    â”‚
           â”‚
           â–¼
    Render Button
    â”œâ”€ Disabled if: no user
    â”œâ”€ Icon: heart (fas/far)
    â”œâ”€ Color: gray (not favorite) / red (favorite)
    â”‚
           â”‚
    User Clicks Button
           â”‚
           â–¼
    toggleFavorite()
    â”œâ”€ Check: user exists
    â”œâ”€ Set loading = true
    â”‚
    â”œâ”€ POST /toggle { hotelId }
    â”‚
    â”œâ”€ On Success:
    â”‚   â”œâ”€ Update isFavorite
    â”‚   â”œâ”€ Re-render
    â”‚   â””â”€ Animation plays
    â”‚
    â”œâ”€ On Error:
    â”‚   â”œâ”€ Show alert
    â”‚   â”œâ”€ Fallback toggle
    â”‚   â””â”€ Log error
    â”‚
    â””â”€ Finally: Set loading = false
```

---

## ğŸ“Š API Request/Response Cycle

### Toggle Favorite Request

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CLIENT                                â”‚
â”‚  FavoriteButton.jsx                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ toggleFavorite()                                     â”‚  â”‚
â”‚  â”‚  â””â”€ setLoading(true)                               â”‚  â”‚
â”‚  â”‚  â””â”€ POST /favorites/{userId}/toggle                â”‚  â”‚
â”‚  â”‚      â”œâ”€ Body: { hotelId: "..." }                  â”‚  â”‚
â”‚  â”‚      â””â”€ Header: Authorization: Bearer {token}    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                      â”‚                                      â”‚
â”‚         HTTP POST   â”‚ 200 OK                                â”‚
â”‚                     â–¼                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      BACKEND                                â”‚
â”‚  favoriteRouter POST /:userId/toggle                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ verifyToken middleware                              â”‚  â”‚
â”‚  â”‚  â””â”€ Validate JWT                                    â”‚  â”‚
â”‚  â”‚  â””â”€ Extract user info                              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                  â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ toggleFavorite controller                           â”‚  â”‚
â”‚  â”‚  â”œâ”€ Extract userId, hotelId                        â”‚  â”‚
â”‚  â”‚  â”œâ”€ Validate input                                 â”‚  â”‚
â”‚  â”‚  â”œâ”€ Find user by ID                               â”‚  â”‚
â”‚  â”‚  â”œâ”€ Check if hotelId in favorites                 â”‚  â”‚
â”‚  â”‚  â”‚                                                  â”‚  â”‚
â”‚  â”‚  â”œâ”€ If yes:                                        â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ Remove from array                          â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ isFav = false                             â”‚  â”‚
â”‚  â”‚  â”‚                                                  â”‚  â”‚
â”‚  â”‚  â”œâ”€ If no:                                         â”‚  â”‚
â”‚  â”‚  â”‚  â”œâ”€ Add to array                               â”‚  â”‚
â”‚  â”‚  â”‚  â””â”€ isFav = true                              â”‚  â”‚
â”‚  â”‚  â”‚                                                  â”‚  â”‚
â”‚  â”‚  â”œâ”€ user.save() â†’ MongoDB update                  â”‚  â”‚
â”‚  â”‚  â”‚                                                  â”‚  â”‚
â”‚  â”‚  â””â”€ Response: {                                    â”‚  â”‚
â”‚  â”‚      message: "Hotel added/removed",              â”‚  â”‚
â”‚  â”‚      isFavorite: true/false                       â”‚  â”‚
â”‚  â”‚    }                                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                      â”‚                                      â”‚
â”‚         HTTP 200    â”‚                                        â”‚
â”‚                     â–¼                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      CLIENT                                â”‚
â”‚  Handle Response                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ if (response.data) {                               â”‚  â”‚
â”‚  â”‚   setIsFavorite(response.data.isFavorite)         â”‚  â”‚
â”‚  â”‚ }                                                  â”‚  â”‚
â”‚  â”‚ setLoading(false)                                 â”‚  â”‚
â”‚  â”‚                                                   â”‚  â”‚
â”‚  â”‚ Re-render with new state                         â”‚  â”‚
â”‚  â”‚ â¤ï¸ Heart changes color                           â”‚  â”‚
â”‚  â”‚ Animation plays                                  â”‚  â”‚
â”‚  â”‚ Tooltip updates                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ³ Component Tree

```
App
â”œâ”€â”€ Navbar
â”œâ”€â”€ Header
â”‚
â”œâ”€â”€ Home Page
â”‚   â””â”€â”€ SearchList
â”‚       â”œâ”€â”€ SearchItem (with FavoriteButton)
â”‚       â”œâ”€â”€ SearchItem (with FavoriteButton)
â”‚       â””â”€â”€ SearchItem (with FavoriteButton)
â”‚
â”œâ”€â”€ Hotel Detail Page
â”‚   â”œâ”€â”€ HotelHeader (with FavoriteButton)
â”‚   â”œâ”€â”€ HotelImages
â”‚   â”œâ”€â”€ HotelContent
â”‚   â””â”€â”€ Reserve
â”‚
â”œâ”€â”€ Favorites Page
â”‚   â””â”€â”€ HotelsList
â”‚       â”œâ”€â”€ SearchItem (with FavoriteButton)
â”‚       â”œâ”€â”€ SearchItem (with FavoriteButton)
â”‚       â””â”€â”€ SearchItem (with FavoriteButton)
â”‚
â””â”€â”€ Footer
```

---

## ğŸ” Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         User Login                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/auth/login                    â”‚
â”‚ â”œâ”€ username, password                    â”‚
â”‚ â–¼                                        â”‚
â”‚ Backend verifies credentials             â”‚
â”‚ â””â”€ Generate JWT token                   â”‚
â”‚                                          â”‚
â”‚ Response: {                              â”‚
â”‚   token: "eyJhbGc...",                   â”‚
â”‚   user: { _id: "123", ... }             â”‚
â”‚ }                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    Save to localStorage:
    â”œâ”€ localStorage.setItem('token', token)
    â””â”€ localStorage.setItem('user', JSON.stringify(user))
         â”‚
         â–¼
    FavoriteButton can now:
    â”œâ”€ Access user._id from AuthContext
    â”œâ”€ Access token from localStorage
    â””â”€ Add Authorization header to requests
         â”‚
         â–¼
    API Call:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ POST /api/favorites/:userId/toggle   â”‚
    â”‚ Headers: {                           â”‚
    â”‚   Authorization: "Bearer {token}"    â”‚
    â”‚ }                                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
    Backend verifies token via verifyToken middleware
    â”œâ”€ Decode JWT
    â”œâ”€ Check expiration
    â”œâ”€ Extract user info
    â””â”€ Proceed if valid, reject if invalid
```

---

## ğŸ“± UI State Diagram

### FavoriteButton States

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Not Logged In   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                      [Button Disabled]
                       [Gray Heart]
                      [No Tooltip]
                             â”‚
                             â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Logged In - New  â”‚
                    â”‚  (First Time Load)â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    [Loading State]
                    [Check API...]
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Not Favorite     â”‚  â”‚   Favorite       â”‚
         â”‚   (isFav = false)  â”‚  â”‚   (isFav = true) â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                   â”‚
         [Button Enabled]      [Button Enabled]
         [Gray/White Heart]    [Red Heart] â¤ï¸
         [Tooltip: "Add"]      [Tooltip: "Remove"]
         [Hover: Light BG]     [Hover: Light BG]
                  â”‚                   â”‚
            Click â”‚                   â”‚ Click
                  â”‚                   â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Toggle To     â”‚  â”‚   Toggle To     â”‚
         â”‚   Favorite      â”‚  â”‚   Not Favorite  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                   â”‚
            API Processing      API Processing
                  â”‚                   â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ Update State &  â”‚
                     â”‚ Re-Render       â”‚
                     â”‚ (Animation)     â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—‚ï¸ Database Update Flow

```
Current User State:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User {                  â”‚
â”‚   _id: "user123",       â”‚
â”‚   username: "john",     â”‚
â”‚   favorites: [          â”‚
â”‚     "hotel_A_id",       â”‚
â”‚     "hotel_B_id"        â”‚
â”‚   ]                     â”‚
â”‚ }                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User clicks favorite button for hotel_C
           â”‚
           â–¼

Check if "hotel_C_id" in favorites array
â””â”€ No, it's not there
           â”‚
           â–¼

Add "hotel_C_id" to array
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User {                  â”‚
â”‚   _id: "user123",       â”‚
â”‚   username: "john",     â”‚
â”‚   favorites: [          â”‚
â”‚     "hotel_A_id",       â”‚
â”‚     "hotel_B_id",       â”‚
â”‚     "hotel_C_id"  â—„â”€â”€â”€ NEW
â”‚   ]                     â”‚
â”‚ }                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

            â”‚
            â–¼

user.save() â†’ MongoDB update
            â”‚
            â–¼

Return { isFavorite: true }
            â”‚
            â–¼

Update UI (show red heart)
```

---

## ğŸ“Š Performance Optimization

```
Without Optimization:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Every render â†’ Check API    â”‚
â”‚ Every list item â†’ Check API â”‚
â”‚ â†’ Heavy network traffic     â”‚
â”‚ â†’ Slow UI                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

With Component State Cache:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Component mount â†’ Check API â”‚
â”‚ Save result in state        â”‚
â”‚ Re-renders use state        â”‚
â”‚ â†’ Minimal API calls         â”‚
â”‚ â†’ Fast UI updates           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Batch Favorites Fetching:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Old: Multiple GET calls     â”‚
â”‚   GET hotel 1               â”‚
â”‚   GET hotel 2               â”‚
â”‚   GET hotel 3               â”‚
â”‚   â†’ 3 API calls             â”‚
â”‚                             â”‚
â”‚ New: Single batch call      â”‚
â”‚   GET /favorites/hotels     â”‚
â”‚   â†’ Returns all details     â”‚
â”‚   â†’ 1 API call              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Error Handling Flow

```
User Action (Click)
       â”‚
       â–¼
Try {
  Validate input
       â”‚
       â”œâ”€ No hotel ID â†’ Error
       â”‚     â””â”€ console.error() + show message
       â”‚
  Call API
       â”‚
  Catch Error
       â”œâ”€ Network error â†’ Show "CÃ³ lá»—i xáº£y ra"
       â”œâ”€ API error â†’ Log error
       â””â”€ Fallback: Manual toggle UI
}
Finally {
  setLoading(false) â†’ Enable button
}
       â”‚
       â–¼
User can retry or report issue
```

---

**Visual diagrams help understand the complete system architecture and flow! ğŸ¨**
